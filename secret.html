<div id="upload-section" style="display: none;">
  <h2>Upload Image</h2>
  <input type="file" id="fileInput" />
  <button onclick="uploadImage()">Upload</button>
  <p id="uploadStatus"></p>
</div>

<script>
  // âœ… Show upload section only if logged in
  netlifyIdentity.on("login", () => {
    document.getElementById("upload-section").style.display = "block";
  });

  async function uploadImage() {
    const fileInput = document.getElementById("fileInput");
    if (!fileInput.files.length) {
      alert("Please select a file first!");
      return;
    }

    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onloadend = async () => {
      const user = netlifyIdentity.currentUser();
      const token = await user.jwt();

      const response = await fetch("/.netlify/functions/upload-image", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify({ file: reader.result }),
      });

      const result = await response.json();
      document.getElementById("uploadStatus").innerText =
        result.url ? "Uploaded: " + result.url : "Error: " + result.error;
    };

    reader.readAsDataURL(file);
  }
</script>
