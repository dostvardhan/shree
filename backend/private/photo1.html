<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Photo 1 — Sweet Memories</title>

<meta http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' https:; img-src 'self' data:; style-src 'self' 'unsafe-inline'; media-src 'self';">

<style>
  :root{
    --bg1:#fff0f0; --bg2:#ffdedd; --ink:#6b2a2f;
    --card:#fff; --muted:#97555a;
    --accent:#6d2a47;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:
    radial-gradient(900px 400px at 10% 10%, rgba(255,255,255,0.35), transparent 25%),
    linear-gradient(180deg,var(--bg1),var(--bg2)); color:var(--ink); -webkit-font-smoothing:antialiased;}

  /* page container */
  .wrap{max-width:1100px;margin:28px auto;padding:12px;box-sizing:border-box;}

  /* large "A4-like" photo area */
  .photo-frame{
    background:transparent; border-radius:14px; padding:10px;
    display:flex; justify-content:center; align-items:center;
  }
  .photo-full {
    width:900px; max-width:94vw; /* A4-ish width, responsive */
    border-radius:12px;
    display:block; margin:0 auto; box-shadow: 0 30px 60px rgba(0,0,0,0.12);
    background: #fff; overflow:hidden;
  }
  .photo-full img{
    display:block; width:100%; height:auto; object-fit:contain;
    user-select:none;
  }

  /* caption */
  .caption {
    text-align:center; margin:18px 0 10px;
  }
  .cap-bubble{
    display:inline-block; background:rgba(255,255,255,0.95);
    padding:12px 22px; border-radius:999px; font-style:italic;
    box-shadow:0 18px 40px rgba(0,0,0,0.07);
    color:var(--muted); font-size:16px;
  }

  /* bottom nav */
  .bottom-nav{display:flex;gap:14px;justify-content:center;margin-top:18px}
  .nav-pill{background:#fff;padding:10px 18px;border-radius:999px;text-decoration:none;color:var(--ink);
           box-shadow:0 12px 26px rgba(0,0,0,0.06);font-weight:600}
  .nav-pill:hover{transform:translateY(-3px);transition:transform .18s ease}

  /* side hearts (prev/next) */
  .nav-heart{position:fixed;top:50%;transform:translateY(-50%);z-index:140;font-size:44px;cursor:pointer;
            text-decoration:none;display:flex;align-items:center;justify-content:center;width:60px;height:60px;border-radius:999px;}
  .nav-left{left:12px}
  .nav-right{right:12px}
  .nav-heart span{font-size:28px;color:#5a2430;display:inline-block}

  /* music control (bottom-right) */
  .music-btn{position:fixed;right:16px;bottom:18px;width:58px;height:58px;border-radius:50%;
             display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#fffafc,#ffeff2);
             box-shadow:0 12px 28px rgba(0,0,0,0.12);z-index:160;cursor:pointer;border:none}
  .music-btn.playing svg .heart { fill:#ffd166 }
  .vol-pop{position:fixed; right:16px; bottom:86px; width:220px;padding:10px;border-radius:12px;
           box-shadow:0 12px 30px rgba(0,0,0,0.12); background:linear-gradient(180deg,#fff,#fff7f7);
           display:none; align-items:center; gap:12px; z-index:170}
  .vol-pop.show{display:flex}
  .vol-range{width:130px;height:6px;border-radius:999px;appearance:none;background:linear-gradient(90deg,#ffc1c1,#ffd88a)}
  .vol-range::-webkit-slider-thumb{appearance:none;width:16px;height:16px;border-radius:50%;background:#fff;border:3px solid #ffb0a0;box-shadow:0 4px 10px rgba(0,0,0,0.12)}

  /* floating tiny hearts (canvas or particles) */
  #fxCanvas{position:fixed;left:0;top:0;width:100vw;height:100vh;pointer-events:none;z-index:80}

  /* responsive tweaks */
  @media (max-width:720px){
    .nav-heart{width:48px;height:48px;font-size:36px}
    .nav-heart span{font-size:22px}
    .music-btn{width:52px;height:52px}
    .caption .cap-bubble{font-size:15px;padding:10px 16px}
  }
</style>
</head>
<body>

<!-- auth guard: if backend /api/diag fails redirect to index -->
<script>
(async function(){
  try{
    const r = await fetch('/api/diag',{credentials:'include'});
    if(!r.ok) throw 0;
  }catch(e){
    // not authenticated — redirect to login
    location.href = '/index.html';
  }
})();
</script>

<!-- floating hearts canvas -->
<canvas id="fxCanvas" aria-hidden="true"></canvas>

<!-- prev / next hearts -->
<a id="prevHeart" class="nav-heart nav-left" href="life.html" aria-label="Back to life"><span>❤</span></a>
<a id="nextHeart" class="nav-heart nav-right" href="photo2.html" aria-label="Next photo"><span>❤</span></a>

<div class="wrap">
  <div class="photo-frame">
    <figure class="photo-full" role="group" aria-label="Memory photo">
      <!-- if using Drive use: /api/file/<id> -->
      <img id="mainPhoto" src="/photos/photo1.jpg" alt="Photo 1 — Sweet memory" />
    </figure>
  </div>

  <div class="caption" aria-live="polite">
    <div class="cap-bubble">“A smile is the beauty of the soul.”</div>
  </div>

  <div class="bottom-nav" role="navigation" aria-label="Bottom navigation">
    <a class="nav-pill" href="/life.html">Life</a>
    <a class="nav-pill" href="/gallery.html">Gallery</a>
    <a class="nav-pill" href="/auth/logout">Logout</a>
  </div>
</div>

<!-- unified mini music player + volume popover -->
<button id="musicButton" class="music-btn" aria-pressed="false" aria-label="Play background music" title="Play / Pause music">
  <svg viewBox="0 0 24 24" width="26" height="26" aria-hidden="true" focusable="false">
    <path class="heart" d="M12 21s-7.33-4.94-9.33-7.02C.8 11.9 2.1 7.9 5.5 6.3 7.2 5.4 9.1 6 10 7.3c.9-1.3 2.8-1.9 4.5-1 3.4 1.6 4.7 5.6 2.8 7.68C19.33 16.06 12 21 12 21z" fill="#ff6b81"/>
  </svg>
</button>

<div id="volPop" class="vol-pop" role="dialog" aria-hidden="true">
  <div style="font-size:13px;color:#6b2b2b">Vol</div>
  <input id="volRange" class="vol-range" type="range" min="0" max="100" step="1" value="60" aria-label="Volume slider" />
  <button id="muteBtn" title="Mute/unmute" style="border:none;background:#fff;padding:6px;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.06);cursor:pointer">🔈</button>
</div>

<audio id="bgMusic" loop preload="auto"><source src="/music/bg.mp3" type="audio/mpeg"></audio>

<script>
/* ---------- floating tiny hearts canvas (soft pastel dots/hearts) ---------- */
(function(){
  const c = document.getElementById('fxCanvas');
  if(!c) return;
  const ctx = c.getContext('2d');
  const DPR = Math.max(1, window.devicePixelRatio || 1);
  let W=0,H=0,parts=[];
  const COLORS = ['#ffd6e0','#ffe8cc','#e6f7ff','#e9f7e9','#eae8ff','#fff0f6','#fff4de'];

  function resize(){ W = innerWidth*DPR; H = innerHeight*DPR; c.width = W; c.height = H; c.style.width='100vw'; c.style.height='100vh'; }
  function spawn(){
    if(parts.length>90) return;
    parts.push({
      x: Math.random()*W,
      y: H + (Math.random()*200*DPR),
      r: (3 + Math.random()*8) * DPR,
      vx: (Math.random()*2 -1) * 0.4 * DPR,
      vy: - (1 + Math.random()*3) * DPR,
      alpha: 0.9 + Math.random()*0.3,
      color: COLORS[Math.floor(Math.random()*COLORS.length)],
      rot: Math.random()*Math.PI
    });
  }
  function draw(){
    ctx.clearRect(0,0,W,H);
    if(Math.random()<0.12) spawn();
    for(let i=parts.length-1;i>=0;i--){
      const p = parts[i];
      p.x += p.vx; p.y += p.vy; p.rot += 0.01;
      p.alpha -= 0.0006;
      if(p.y < -100*DPR || p.alpha <= 0.02) { parts.splice(i,1); continue; }
      ctx.save();
      ctx.globalAlpha = Math.max(0,p.alpha*0.95);
      ctx.fillStyle = p.color;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
      ctx.restore();
    }
    requestAnimationFrame(draw);
  }
  addEventListener('resize', resize, {passive:true});
  resize(); draw();
})();

/* ---------- prev/next links logic ---------- */
(function(){
  const m = (location.pathname||'').match(/photo(\d+)\.html/i);
  const total = 9;
  let cur = 1;
  if(m && m[1]) cur = parseInt(m[1],10);
  const prev = (cur>1 ? cur-1 : 1);
  const next = (cur<total ? cur+1 : 1);
  const prevLink = document.getElementById('prevHeart');
  const nextLink = document.getElementById('nextHeart');
  // photo1: left should go to life.html (done in href). keep left as life.html.
  if(prevLink && cur>1) prevLink.href = 'photo'+prev+'.html';
  if(nextLink) nextLink.href = 'photo'+next+'.html';
  if(prevLink){ prevLink.addEventListener('click', e=>{ /* default is fine (link) */ }); }
})();

/* ---------- music control ---------- */
(function(){
  const btn = document.getElementById('musicButton');
  const volPop = document.getElementById('volPop');
  const volRange = document.getElementById('volRange');
  const muteBtn = document.getElementById('muteBtn');
  const music = document.getElementById('bgMusic');

  function applyVolume(v){
    music.volume = Math.max(0,Math.min(100,parseInt(v||60,10)))/100;
    try{ localStorage.setItem('shree_music_volume', String(v)); } catch(e){}
  }
  try{ const sv = localStorage.getItem('shree_music_volume'); if(sv!==null) volRange.value = sv; applyVolume(volRange.value); } catch(e){}
  try{ if(localStorage.getItem('shree_music_playing') === '1'){ music.play().then(()=>btn.classList.add('playing')).catch(()=>{}); } } catch(e){}

  function setPlaying(p){
    if(p){ btn.classList.add('playing'); music.play().catch(()=>{}); localStorage.setItem('shree_music_playing','1'); btn.setAttribute('aria-pressed','true'); }
    else { btn.classList.remove('playing'); music.pause(); localStorage.setItem('shree_music_playing','0'); btn.setAttribute('aria-pressed','false'); }
  }

  btn.addEventListener('click', (e)=>{
    if(e.target && e.target.closest('#volPop')) return;
    setPlaying(!btn.classList.contains('playing'));
  });

  btn.addEventListener('contextmenu', e => { e.preventDefault(); volPop.classList.toggle('show'); volPop.setAttribute('aria-hidden', volPop.classList.contains('show') ? 'false':'true'); });
  volRange.addEventListener('input', ()=> applyVolume(volRange.value));
  muteBtn.addEventListener('click', ()=>{
    if(music.volume > 0){ volRange.dataset.prev = volRange.value; volRange.value = 0; } else { volRange.value = volRange.dataset.prev || 60; }
    applyVolume(volRange.value);
  });
  document.addEventListener('click', (e)=>{ if(!e.target.closest('.vol-pop') && !e.target.closest('#musicButton')){ volPop.classList.remove('show'); volPop.setAttribute('aria-hidden','true'); } });
  music.addEventListener('play', ()=> btn.classList.add('playing'));
  music.addEventListener('pause', ()=> btn.classList.remove('playing'));
})();
</script>

</body>
</html>
