<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Gallery • Shreshtha</title>
<style>
  :root{
    --bg1:#ffe6ee; --bg2:#ffd1e0; --ink:#523043; --muted:#775362;
    --card:rgba(255,255,255,.5); --shadow:0 12px 32px rgba(82,48,67,.18);
  }
  *{box-sizing:border-box} html,body{height:100%;margin:0}
  body{
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    color:var(--ink);
    background: linear-gradient(160deg,var(--bg1),var(--bg2));
    background-attachment: fixed;
  }
  header{padding:20px 16px;text-align:center}
  h1{margin:0;font-size:clamp(24px,4vw,34px)}
  .wrap{max-width:1100px;margin:0 auto;padding:10px 16px 40px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
  .card{background:var(--card);border-radius:14px;box-shadow:var(--shadow);overflow:hidden}
  .thumb{width:100%;height:220px;object-fit:cover;display:block;background:#fff}
  .cap{padding:10px 12px;font-size:14px;color:var(--muted)}
  .empty{margin:40px auto;text-align:center;color:var(--muted)}
  .btn{display:inline-block;margin-top:12px;padding:10px 16px;border-radius:999px;background:#6d2a47;color:#fff;text-decoration:none;font-weight:700}
</style>
</head>
<body>
  <header><h1>Gallery</h1></header>
  <div class="wrap">
    <div id="status" class="empty">Loading photos…</div>
    <div id="grid" class="grid" hidden></div>
  </div>

<script>
(async function(){
  const status = document.getElementById('status');
  const grid = document.getElementById('grid');

  try {
    const res = await fetch('/api/list', { headers: { 'Accept':'application/json' } });
    if (res.status === 401) {
      status.innerHTML = `You need to log in to view the gallery.<br/><a class="btn" href="/auth/login">Log in</a>`;
      return;
    }
    if (!res.ok) throw new Error('List failed');
    const items = await res.json();

    if (!Array.isArray(items) || items.length === 0) {
      status.innerHTML = 'No photos yet.';
      return;
    }

    status.hidden = true; grid.hidden = false;
    items.forEach(it => {
      const card = document.createElement('article');
      card.className = 'card';
      const img = document.createElement('img');
      img.className = 'thumb';
      img.loading = 'lazy';
      img.alt = it.caption || it.name || 'photo';
      // We stream securely from backend
      img.src = `/api/file/${it.id}`;
      const cap = document.createElement('div');
      cap.className = 'cap';
      cap.textContent = it.caption || '';
      card.appendChild(img);
      card.appendChild(cap);
      grid.appendChild(card);
    });
  } catch (e) {
    status.textContent = 'Something went wrong loading the gallery.';
    console.error(e);
  }
})();
</script>
</body>
</html>
