<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Cache-Control" content="no-store, max-age=0">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Shreshtha – Gallery</title>

<!-- Auth & guards -->
<script src="/auth0-spa-js.production.js"></script>
<script src="auth-init.js" defer></script>
<script src="guard-auth.js" defer></script>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Italianno&display=swap" rel="stylesheet">
<style>
  :root{
    --cream:#FFE7DA; --peach:#FFB59E; --red:#FF6B6B;
    --text:#6e2430; --panel:rgba(255,255,255,.05);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Playfair Display",serif;
    color:var(--text);
    background:linear-gradient(135deg,var(--cream),var(--peach) 48%,var(--red));
    overflow-x:hidden;
  }
  header{text-align:center;padding:24px 12px;}
  .logo{font-family:"Italianno",cursive;font-size:46px;text-shadow:0 2px 10px rgba(0,0,0,.25);}
  nav{margin-top:8px;}
  nav a{margin:0 12px;padding:8px 18px;background:rgba(255,255,255,.15);
        border-radius:999px;text-decoration:none;color:var(--text);
        box-shadow:0 4px 8px rgba(0,0,0,.18);}
  nav a:hover{background:rgba(255,255,255,.3);}
  main{max-width:1200px;margin:30px auto;padding:0 18px;}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:22px;}

  /* CARD */
  .card{
    background:var(--panel);
    border-radius:16px;
    overflow:hidden;
    box-shadow:0 18px 40px rgba(0,0,0,.25);
    position:relative;
    transition:transform .3s cubic-bezier(.2,.9,.3,1);
  }
  .card:hover{transform:translateY(-6px);}

  /* œ… No-crop thumbnail: full image visible (letterbox) */
  .imgbox{
    height:320px;               /* thumbnail area height */
    background:#fff9f7;         /* soft backdrop behind transparent images */
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .imgbox img{
    max-width:100%;
    max-height:100%;
    object-fit:contain;         /* <- show full image, no crop */
    display:block;
  }

  .meta{padding:12px 14px 16px;text-align:center;font-style:italic;font-size:15px;}
  .empty{text-align:center;font-size:18px;margin-top:80px;opacity:.8;}

  /* Floating hearts */
  .heart{position:fixed;font-size:18px;opacity:.75;
         animation:floatUp linear infinite;pointer-events:none;}
  @keyframes floatUp{
    0%{transform:translateY(0) scale(1);opacity:.9;}
    100%{transform:translateY(-120vh) scale(1.4);opacity:0;}
  }
</style>
</head>
<body>
<header>
  <meta http-equiv="Cache-Control" content="no-store, max-age=0">
  <div class="logo">Gallery of Sweet Memories</div>
  <nav>
    <a href="life.html">Back to Life</a>
    <a href="upload.html">Upload</a>
    <a href="/auth/logout">Logout</a>
  </nav>
</header>

<main>
  <section id="grid" class="grid"></section>
  <div id="empty" class="empty" style="display:none;">No photos uploaded yet ðŸŒ¸</div>
</main>

<script>
/* floating hearts background */
const colors=["#ffd6e0","#ffb7c5","#ffd27a","#ffc4a3","#ffffffaa"];
function spawnHeart(){
  const h=document.createElement("div");
  h.className="heart";
  h.textContent=Math.random()>0.5?"¤":"™¡";
  h.style.left=(2+Math.random()*96)+"vw";
  h.style.bottom="-24px";
  h.style.fontSize=(10+Math.random()*22)+"px";
  h.style.color=colors[(Math.random()*colors.length)|0];
  h.style.animationDuration=(10+Math.random()*10)+"s";
  document.body.appendChild(h);
  setTimeout(()=>h.remove(),20000);
}
for(let i=0;i<25;i++) setTimeout(spawnHeart,i*180);
setInterval(spawnHeart,800);

/* fetch photo list from backend */
async function loadGallery(){
  try{
    const res = await authFetch("/api/list");
    if(!res.ok) throw new Error("Failed to list photos");
    const data = await res.json();
    const grid = document.getElementById("grid");
    if(!data || !data.length){
      document.getElementById("empty").style.display="block";
      return;
    }
    data.forEach(item=>{
      const card=document.createElement("article");
      card.className="card";

      // clickable image to open full in new tab (Drive stream)
      const link = document.createElement("a");
      link.href = `/api/file/${item.id}`;
      link.target = "_blank";
      link.rel = "noopener";

      const imgbox=document.createElement("div");
      imgbox.className="imgbox";

      const img=document.createElement("img");
      img.src=`/api/file/${item.id}`;
      img.alt=item.caption||"memory";

      imgbox.appendChild(img);
      link.appendChild(imgbox);
      card.appendChild(link);

      const meta=document.createElement("div");
      meta.className="meta";
      meta.textContent=item.caption||"";
      card.appendChild(meta);

      grid.appendChild(card);
    });
  }catch(err){
    console.error(err);
    const e = document.getElementById("empty");
    e.textContent="Error loading gallery ðŸ’”";
    e.style.display="block";
  }
}
document.addEventListener("DOMContentLoaded",loadGallery);
</script>


<!-- START: artifact cleaner -->
<script>
(function(){
  // hide tiny stray text nodes like "", "™" etc.
  document.querySelectorAll("body *").forEach(el=>{
    if(el.childNodes.length===1 && el.firstChild.nodeType===3){
      const t = el.textContent.trim();
      if(t && /^[¤¢™©®]{1,4}$/.test(t)) { el.style.display="none"; }
    }
  });
})();
</script>
<!-- END: artifact cleaner -->
<!-- START: floating hearts (canvas version) -->
<canvas id="heartsCanvas" aria-hidden="true"></canvas>
<script>
(() => {
  const c = document.getElementById('heartsCanvas');
  if(!c) return;
  const ctx = c.getContext('2d');
  let W,H,hearts=[];
  const DPR = Math.max(1, window.devicePixelRatio||1);
  function resize(){
    W=innerWidth*DPR;H=innerHeight*DPR;
    c.width=W;c.height=H;
    c.style.width=innerWidth+'px';c.style.height=innerHeight+'px';
  }
  function rand(a,b){return Math.random()*(b-a)+a;}
  function spawn(){
    if(hearts.length>40)return;
    hearts.push({
      x:rand(0,W),
      y:H+rand(10,200),
      s:rand(10,25),
      vx:rand(-20,20),
      vy:-rand(40,80),
      a:rand(0.5,1),
      rot:rand(0,Math.PI),
      vr:rand(-0.02,0.02)
    });
  }
  function drawHeart(x,y,s,rot,a){
    ctx.save();
    ctx.translate(x,y);
    ctx.rotate(rot);
    ctx.scale(s,s);
    ctx.beginPath();
    ctx.moveTo(0,-0.5);
    ctx.bezierCurveTo(0.5,-1.2,1.3,-0.1,0,0.8);
    ctx.bezierCurveTo(-1.3,-0.1,-0.5,-1.2,0,-0.5);
    ctx.closePath();
    ctx.globalAlpha=a;
    ctx.fillStyle="#ff7aa2";
    ctx.fill();
    ctx.restore();
  }
  function tick(){
    ctx.clearRect(0,0,W,H);
    if(Math.random()<0.15)spawn();
    hearts.forEach(h=>{
      h.x+=h.vx*0.016;h.y+=h.vy*0.016;h.rot+=h.vr;h.a-=0.002;
    });
    hearts=hearts.filter(h=>h.y>-60&&h.a>0);
    hearts.forEach(h=>drawHeart(h.x,h.y,h.s/50,h.rot,h.a));
    requestAnimationFrame(tick);
  }
  Object.assign(c.style,{
    position:'fixed',left:0,top:0,zIndex:0,pointerEvents:'none'
  });
  addEventListener('resize',resize,{passive:true});
  resize();tick();
})();
</script>
<!-- END: floating hearts -->
</body>
</html>













