<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Upload — Sweet Memories</title>

  <script src="/auth0-spa-js.production.js"></script>
  <script src="auth-init.js" defer></script>
  <script src="guard-auth.js" defer></script>

  <link rel="stylesheet" href="/assets/css/music-heart.css">
  <script src="/assets/js/music-heart.js" defer></script>

  <style>
    :root {
      --accent: #b97c3c;
      --text: #2b1410;
      font-family: "Playfair Display", serif;
    }

    html, body {
      height: 100%;
      margin: 0;
      overflow-x: hidden;
      color: var(--text);
    }

    /* ==========================================================
       OPTION B: Softer painterly version with haze overlay
       ========================================================== */
    body#uploadPage {
      background:
        radial-gradient(900px 700px at 80% 10%, rgba(22,105,108,0.7), transparent 60%),
        radial-gradient(1200px 900px at 10% 90%, rgba(205,139,77,0.7), transparent 65%),
        conic-gradient(from 220deg at 25% 80%, rgba(200,120,70,0.6), rgba(245,237,225,0.1) 60%, rgba(15,95,100,0.6) 90%, rgba(240,200,150,0.7)),
        radial-gradient(600px 480px at 50% 35%, rgba(255,252,245,0.9), rgba(248,238,228,0.8), transparent 75%);
      background-blend-mode: overlay, multiply, screen, normal;
      background-attachment: fixed;
      filter: blur(0.4px) saturate(110%);
    }

    /* Gentle light mist to soften */
    body#uploadPage::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at 60% 20%, rgba(255,255,255,0.22), rgba(255,255,255,0.12) 60%, rgba(0,0,0,0.1));
      backdrop-filter: blur(4px);
      mix-blend-mode: lighten;
      opacity: 0.45;
    }

    header {
      text-align: center;
      padding: 18px 12px 8px;
      position: relative;
      z-index: 2;
    }
    .page-links a {
      display: inline-block;
      margin: 0 6px;
      padding: 6px 12px;
      border-radius: 18px;
      background: rgba(255,255,255,0.4);
      color: #3b0d14;
      text-decoration: none;
      box-shadow: 0 8px 16px rgba(0,0,0,0.12);
      font-size: 14px;
    }
    .page-links a:hover { background: rgba(255,255,255,0.6); }

    h1 {
      margin: 18px 0 14px;
      font-size: 46px;
      color: #3b0d14;
      text-shadow: 0 4px 8px rgba(0,0,0,0.12);
    }

    main {
      max-width: 960px;
      margin: 30px auto 100px;
      padding: 0 20px;
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 26px;
      visibility: hidden;
      opacity: 0;
      transition: opacity .25s;
      position: relative;
      z-index: 2;
    }
    @media (max-width: 960px) { main { grid-template-columns: 1fr; } }

    .card {
      background: rgba(255,255,255,0.85);
      border-radius: 18px;
      padding: 20px 22px 24px;
      box-shadow: 0 16px 40px rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.5);
      backdrop-filter: blur(12px);
    }

    label { display: block; margin: 10px 0 6px; font-weight: 700; }
    input[type="file"], textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.1);
      background: #fff;
      font-size: 15px;
      color: #3a2a20;
    }
    textarea { min-height: 100px; resize: vertical; }

    .drop {
      border: 2px dashed rgba(0,0,0,0.15);
      border-radius: 16px;
      padding: 28px;
      text-align: center;
      background: rgba(255,255,255,0.75);
      margin-bottom: 14px;
      transition: all .2s ease;
    }
    .drop.dragover { background: rgba(228,247,246,0.75); border-color: #2d7477; }

    .btn {
      background: linear-gradient(90deg,#b97c3c,#d79a5a);
      color: #fff;
      font-weight: 800;
      border: none;
      padding: 10px 18px;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
      margin-top: 10px;
    }
    .btn:hover { filter: brightness(1.08); }
    .btn.secondary {
      background: transparent;
      color: #3a2a20;
      border: 1px solid rgba(0,0,0,0.12);
    }

    .preview {
      border-radius: 14px;
      overflow: hidden;
      min-height: 320px;
      background: rgba(255,255,255,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 10px;
    }
    .preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 8px;
    }
    .pcaption {
      position: absolute;
      left: 12px;
      right: 12px;
      bottom: 12px;
      background: rgba(0,0,0,0.3);
      color: #fff;
      padding: 8px;
      border-radius: 8px;
      font-size: 13px;
      text-align: center;
      backdrop-filter: blur(3px);
      display: none;
    }

    #musicHeartWrap { position: fixed; right: 16px; bottom: 16px; z-index: 9; }
    #musicHeartBtn { width: 44px; height: 44px; border-radius: 14px; }
  </style>
</head>
<body id="uploadPage">
  <header>
    <div class="page-links">
      <a href="life.html">Life</a>
      <a href="gallery.html">Gallery</a>
      <a href="/logout.html">Logout</a>
    </div>
    <h1>Upload a Sweet Memory</h1>
  </header>

  <main id="protectedContent">
    <section class="card">
      <form id="uploadForm" autocomplete="off">
        <div class="drop" id="drop">
          <div style="font-weight:800">Drag & drop a photo here</div>
          <div style="margin:6px 0 10px;">or</div>
          <input id="file" name="photo" type="file" accept="image/*" style="display:none" />
          <button type="button" class="btn" id="chooseBtn">Choose file</button>
          <div class="meta">JPG/PNG • Max 8 MB</div>
        </div>

        <label for="caption">Caption (short)</label>
        <textarea id="caption" name="caption" maxlength="150" placeholder="Write a short caption (max 150 chars)"></textarea>

        <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
          <button class="btn" type="submit">Upload</button>
          <button class="btn secondary" type="button" id="clearBtn">Clear</button>
          <span id="msg" class="meta"></span>
        </div>
      </form>
    </section>

    <aside class="card preview" id="previewBox">
      <div id="previewInner" class="meta" style="text-align:center;">
        <div style="font-weight:800;color:#1f332f">Preview</div>
        <div style="margin-top:8px">No photo selected</div>
      </div>
      <div class="pcaption" id="pcaption"></div>
    </aside>
  </main>

  <script>
    (function(){
      const el=document.getElementById('protectedContent');
      const show=()=>{el.style.visibility='visible';el.style.opacity='1'};
      if(window.__shreeAuthReady) show();
      else{
        window.addEventListener('shree:auth-ready', show, {once:true});
        setTimeout(()=>{if(getComputedStyle(el).visibility==='hidden')show();},1800);
      }
    })();
  </script>
</body>
</html>
