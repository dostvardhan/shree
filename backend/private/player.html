<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Shree Music Player</title>
<style>
  body{margin:12px;font-family:system-ui,Segoe UI,Roboto;display:flex;align-items:center;gap:12px}
  button{padding:8px 12px;border-radius:8px;border:none;background:#6e2430;color:white;cursor:pointer}
  input[type=range]{width:160px}
  .label{font-size:13px;color:#333}
</style>
</head>
<body>
  <button id="playBtn">Play</button>
  <input id="vol" type="range" min="0" max="1" step="0.01" value="0.6">
  <span class="label" id="status">Stopped</span>

  <audio id="bg" loop preload="auto"></audio>

<script>
  // Set the audio src here; server should serve /api/music
  const audio = document.getElementById('bg');
  audio.src = '/api/music';
  const playBtn = document.getElementById('playBtn');
  const vol = document.getElementById('vol');
  const status = document.getElementById('status');

  // restore volume
  const savedVol = parseFloat(localStorage.getItem('shree_bg_vol'));
  audio.volume = !isNaN(savedVol) ? savedVol : 0.6;
  vol.value = audio.volume;

  function updateUI(){
    status.textContent = audio.paused ? 'Paused' : 'Playing';
    playBtn.textContent = audio.paused ? 'Play' : 'Pause';
  }
  playBtn.addEventListener('click', ()=> {
    if (audio.paused) audio.play().catch(()=>{});
    else audio.pause();
    updateUI();
  });
  audio.addEventListener('play', updateUI);
  audio.addEventListener('pause', updateUI);

  vol.addEventListener('input', (e) => {
    audio.volume = Number(e.target.value);
    localStorage.setItem('shree_bg_vol', String(audio.volume));
  });

  // receive commands from opener via postMessage
  window.addEventListener('message', (ev) => {
    const cmd = ev.data && ev.data.cmd;
    if (!cmd) return;
    if (cmd === 'play') audio.play().catch(()=>{});
    else if (cmd === 'pause') audio.pause();
    else if (cmd === 'toggle') { if (audio.paused) audio.play().catch(()=>{}); else audio.pause(); }
    else if (cmd === 'setVol') { audio.volume = Number(ev.data.v); vol.value = audio.volume; localStorage.setItem('shree_bg_vol', String(audio.volume)); }
  }, false);

  // when ready, tell opener that we're ready
  if (window.opener) window.opener.postMessage({ from:'shreePlayer', ready:true }, '*');

  // try to auto-play if allowed (will be blocked until user interacts)
  audio.play().catch(()=>{ updateUI(); });
  updateUI();
</script>
<!-- Mini Floating Music Player (added by script) -->
<style>
  .music-btn {
    position: fixed;
    bottom: 22px;
    right: 26px;
    width: 54px;
    height: 54px;
    border-radius: 50%;
    background: rgba(255,255,255,0.88);
    box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 150;
    transition: transform .18s ease, box-shadow .18s ease;
  }
  .music-btn:hover { transform: translateY(-3px); box-shadow: 0 14px 28px rgba(0,0,0,0.18); }
  .music-btn.playing { animation: mPulse 2.4s infinite ease-in-out; }
  @keyframes mPulse {
    0% { transform: scale(1); box-shadow: 0 10px 18px rgba(255,105,180,0.12); }
    50% { transform: scale(1.06); box-shadow: 0 18px 30px rgba(255,105,180,0.18); }
    100% { transform: scale(1); box-shadow: 0 10px 18px rgba(255,105,180,0.12); }
  }
  .music-btn svg { width:22px; height:22px; fill:#8b1a1a; }
</style>

<div id="musicButton" class="music-btn" title="Play Music">
  <svg id="musicIcon" viewBox="0 0 24 24" aria-hidden="true"><path d="M8 5v14l11-7z"/></svg>
</div>

<audio id="bgMusic" loop preload="auto">
  <source src="/music/bg.mp3" type="audio/mpeg" />
</audio>

<script>
(() => {
  const btn = document.getElementById('musicButton');
  const icon = document.getElementById('musicIcon');
  const music = document.getElementById('bgMusic');
  let playing = false;
  const playIcon = '<path d="M8 5v14l11-7z"/>';
  const pauseIcon = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';

  // restore last play state if you want (optional)
  try {
    const last = localStorage.getItem('shree_music_playing');
    if (last === '1') { playing = true; icon.innerHTML = pauseIcon; btn.classList.add('playing'); music.play().catch(()=>{}); }
  } catch(e){}

  btn.addEventListener('click', () => {
    playing = !playing;
    if (playing) {
      music.play().catch(()=>{});
      icon.innerHTML = pauseIcon;
      btn.classList.add('playing');
      try { localStorage.setItem('shree_music_playing','1'); } catch(e){}
    } else {
      music.pause();
      icon.innerHTML = playIcon;
      btn.classList.remove('playing');
      try { localStorage.setItem('shree_music_playing','0'); } catch(e){}
    }
  });
})();
</script>
</body>
</html>




