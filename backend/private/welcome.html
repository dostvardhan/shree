<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src 'self' 'unsafe-inline' 'unsafe-eval';
                 connect-src 'self' https:;
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline';
                 media-src 'self';
                 font-src 'self';">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Welcome • Shreshtha</title>

  <script src="/auth0-spa-js.production.js"></script>
  <script src="/auth-init.js?v=7" defer></script>
  <script src="/guard-auth.js?v=7" defer></script>

  <style>
    :root{
      --bg-1:#fff0ef;
      --bg-2:#ffd6d6;
      --bg-3:#ffc0be;
      --text:#6e2430;
      --btn:#6e2430;
      --btn-shadow:rgba(0,0,0,.22);
      --heart-1:#ffd6e0; --heart-2:#ffe8cc; --heart-3:#ffe9ec;
      --heart-4:#ffd1fa; --heart-5:#fbd1d1; --heart-6:#ffe0e0;
    }
    html,body{height:100%}
    body{
      margin:0; display:flex; align-items:center; justify-content:center; flex-direction:column;
      color:var(--text); text-align:center;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Comic Sans MS", cursive;
      background:
        radial-gradient(1200px 600px at 12% 10%, rgba(255,236,240,0.25), transparent 20%),
        radial-gradient(900px 500px at 92% 88%, rgba(255,240,230,0.18), transparent 18%),
        linear-gradient(160deg, var(--bg-1) 0%, var(--bg-2) 18%, var(--bg-3) 60%, #ffb0b0 100%);
      background-attachment: fixed; overflow:hidden;
    }
    body::after{
      content:""; position:fixed; inset:0; pointer-events:none;
      background:
        radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,.25), transparent 60%),
        radial-gradient(120% 120% at 50% 110%, rgba(0,0,0,.08), transparent 50%);
      z-index:0;
    }
    .wrap{ position:relative; z-index:2; transform: translateY(-2vh); padding: 0 18px; }
    h1{ margin:0 0 28px; font-weight:700; font-size: clamp(28px, 5vw, 56px); letter-spacing:.5px;
        text-shadow: 0 2px 12px rgba(0,0,0,.18); }
    .tag{ display:inline-block; margin-bottom:34px; font-size: clamp(13px, 2.6vw, 16px); opacity:.85; }
    a.enter-btn{
      display:inline-block; font-size:18px; background:var(--btn); color:#fff;
      padding:14px 28px; border-radius:42px; text-decoration:none;
      box-shadow: 0 10px 26px var(--btn-shadow);
      transition: transform .18s ease, box-shadow .18s ease, opacity .18s ease;
    }
    a.enter-btn:hover{ transform:translateY(-2px); box-shadow:0 16px 36px rgba(0,0,0,.24);}
    a.enter-btn:active{ transform:scale(.98); }
    @keyframes floatUp { 0%{transform:translateY(0) scale(1);opacity:.95;} 100%{transform:translateY(-110vh) scale(1.45);opacity:0;} }
    .floating-heart{
      position:fixed; bottom:-10px; left:0; font-size:18px; opacity:.9; pointer-events:none;
      animation: floatUp linear forwards; filter: drop-shadow(0 4px 10px rgba(255,120,140,.18));
      z-index:1; user-select:none;
    }

    #musicHeartWrap { position: fixed; right: 18px; bottom: 18px; z-index: 10; display:flex; gap:8px; align-items:center; }
    #musicHeartBtn{
      width:56px;height:56px;border:none;border-radius:50%;cursor:pointer;
      display:flex;align-items:center;justify-content:center;font-size:22px; line-height:1;
      background: radial-gradient(circle at 30% 30%, #ffd6e0, #ff9fb0);
      box-shadow: 0 8px 28px rgba(220,80,110,0.18);
      transition: transform .16s ease, box-shadow .16s ease, opacity .18s ease;
    }
    #musicHeartBtn:active{ transform:scale(.96); }
    #musicHeartBtn.playing{ box-shadow:0 14px 42px rgba(220,80,110,0.28); transform:scale(1.04); }
    #musicHeartBtn .heart{ pointer-events:none; user-select:none; }
    .vol-dot{
      width:18px;height:18px;border-radius:50%;
      background: linear-gradient(150deg,#ffd76d,#ffc96a);
      box-shadow:0 6px 10px rgba(255,170,100,0.22);
      border:2px solid rgba(255,255,255,0.95);
      cursor:pointer; margin-left:-8px;
    }
    .vol-pop{
      position:absolute; right:72px; bottom:10px; width:220px; padding:10px 12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,250,248,0.95));
      border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,0.12);
      display:none; gap:10px; align-items:center;
    }
    .vol-pop.show{ display:flex; }
    .vol-range{ -webkit-appearance:none; width:130px;height:7px;border-radius:999px;background:linear-gradient(90deg,#ffc1c1,#ffd88a); outline:none;}
    .vol-range::-webkit-slider-thumb{ -webkit-appearance:none; width:14px;height:14px;border-radius:50%; background:#fff; box-shadow:0 4px 10px rgba(0,0,0,.12); border:3px solid #ffb0a0; }
    #warm-btn{ display:none; margin-top:16px; padding:10px 22px; font-size:16px; border:none; border-radius:28px; background:#6e2430; color:#fff; box-shadow:0 4px 12px rgba(0,0,0,.2); cursor:pointer; }
  </style>
</head>
<body>

  <div class="wrap" role="main" aria-label="Welcome">
    <h1>Welcome to Shreshtha’s Life of Happiness</h1>
    <div class="tag">Sweet memories live here ✨</div><br/>
    <a class="enter-btn" href="/life.html">Enter Memories</a>
    <button id="warm-btn">Wake Up Server</button>
  </div>

  <audio id="bgMusic" loop preload="auto" style="display:none">
    <source src="/music/bg.mp3" type="audio/mpeg" />
  </audio>

  <div id="musicHeartWrap" aria-hidden="false">
    <button id="musicHeartBtn" aria-label="Toggle background music" title="Play / Pause background music" type="button">
      <span class="heart" aria-hidden="true">♡</span>
    </button>
    <div class="vol-dot" id="musicVolDot" role="button" tabindex="0" aria-label="Volume control" title="Volume"></div>
    <div class="vol-pop" id="musicVolPop" role="dialog" aria-hidden="true">
      <div style="font-size:13px;color:#6b2b2b;">Vol</div>
      <input id="musicVolRange" class="vol-range" type="range" min="0" max="100" step="1" value="60" aria-label="Volume slider" />
      <button id="musicMuteBtn" style="border:none;background:#fff;padding:6px;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.06);cursor:pointer" aria-pressed="false" title="Mute/unmute">M</button>
    </div>
  </div>

  <script>
    (()=>{
      const COLORS=['var(--heart-1)','var(--heart-2)','var(--heart-3)','var(--heart-4)','var(--heart-5)','var(--heart-6)'];
      function spawnHeart(){
        const h=document.createElement('div');
        h.className='floating-heart';
        h.textContent='❤';
        h.style.left = (Math.random()*100) + 'vw';
        h.style.color = COLORS[Math.floor(Math.random()*COLORS.length)];
        h.style.fontSize = (16 + Math.random()*18) + 'px';
        h.style.animationDuration = (8 + Math.random()*6) + 's';
        document.body.appendChild(h);
        setTimeout(()=>h.remove(),15000);
      }
      for(let i=0;i<10;i++) spawnHeart();
      setInterval(spawnHeart, 900);
    })();
  </script>

  <script>
    (async()=>{
      try{ await fetch("/health",{mode:"no-cors"}); }
      catch(e){ document.getElementById("warm-btn").style.display="inline-block"; }
    })();
    document.getElementById("warm-btn").addEventListener("click", async()=>{
      try{ await fetch("/health",{mode:"no-cors"}); alert("Server warmed!"); }catch(e){ alert("Still waking"); }
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", ()=>{
      try{
        if(typeof requireAuth === "function"){
          Promise.resolve(requireAuth({silent:true})).catch(()=>{});
        }
      }catch(e){}
    });
  </script>

  <script>
    (function(){
      const audio = document.getElementById('bgMusic');
      const btn = document.getElementById('musicHeartBtn');
      const volDot = document.getElementById('musicVolDot');
      const volPop = document.getElementById('musicVolPop');
      const volRange = document.getElementById('musicVolRange');
      const muteBtn = document.getElementById('musicMuteBtn');
      if(!audio||!btn||!volDot||!volPop||!volRange||!muteBtn) return;

      function updateBtn(){
        const heart = btn.querySelector('.heart');
        if(!heart) return;
        if(!audio.paused){ btn.classList.add('playing'); heart.textContent='❤'; btn.setAttribute('aria-pressed','true'); }
        else{ btn.classList.remove('playing'); heart.textContent='♡'; btn.setAttribute('aria-pressed','false'); }
      }

      try{
        const sv = localStorage.getItem('shree_music_volume');
        if(sv!==null){ const v=Math.max(0,Math.min(100,parseInt(sv,10))); audio.volume=v/100; volRange.value=v; }
        else{ audio.volume=0.6; }
      }catch(e){ audio.volume=0.6; }

      const savedPlaying = (()=>{ try{return localStorage.getItem('shree_music_playing')==='1';}catch(e){return false;} })();

      btn.addEventListener('click', e=>{
        e.preventDefault();
        if(audio.paused){ audio.play().then(()=>{ localStorage.setItem('shree_music_playing','1'); updateBtn(); }).catch(()=>{}); }
        else{ audio.pause(); localStorage.setItem('shree_music_playing','0'); updateBtn(); }
      });

      volDot.addEventListener('click', e=>{
        e.stopPropagation();
        const show = volPop.classList.toggle('show');
        volPop.setAttribute('aria-hidden', show ? 'false' : 'true');
        if(show) setTimeout(()=>volRange.focus(), 40);
      });
      volDot.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); volDot.click(); }});

      volRange.addEventListener('input', ()=>{
        const v=Math.max(0,Math.min(100,parseInt(volRange.value||60,10)));
        audio.volume=v/100;
        try{ localStorage.setItem('shree_music_volume', String(v)); }catch(e){}
        muteBtn.setAttribute('aria-pressed', v===0 ? 'true':'false');
      });

      muteBtn.addEventListener('click', ()=>{
        if(audio.volume>0){ volRange.dataset.prev=volRange.value; volRange.value=0; }
        else{ volRange.value=volRange.dataset.prev||60; }
        volRange.dispatchEvent(new Event('input'));
      });

      document.addEventListener('click', e=>{
        if(!e.target.closest('.vol-pop') && !e.target.closest('#musicVolDot')){
          volPop.classList.remove('show'); volPop.setAttribute('aria-hidden','true');
        }
      });

      if(savedPlaying){
        audio.play().then(updateBtn).catch(()=>{});
      }
      audio.addEventListener('play', updateBtn);
      audio.addEventListener('pause', updateBtn);
      updateBtn();
    })();
  </script>
</body>
</html>
