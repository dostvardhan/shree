<!DOCTYPE html>
<html lang="en">
<head>
  <!-- CSP -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src 'self' 'unsafe-inline' 'unsafe-eval';
                 connect-src 'self' https:;
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline';
                 media-src 'self';">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sweet Memories — Shreshtha</title>

  <!-- Auth (same as photo pages) -->
  <script src="/auth0-spa-js.production.js" defer></script>
  <script src="/auth-init.js" defer></script>
  <script src="/guard-auth.js" defer></script>

  <style>
    :root{
      --cream:#FFE7DA; --peach:#FFB59E; --red:#FF6B6B;
      --text:#6e2430; --panel:rgba(255,255,255,.05);
      --radius:16px; --shadow:0 18px 40px rgba(0,0,0,.32);
    }
    *{box-sizing:border-box}
    a{text-decoration:none;color:inherit}
    html,body{height:100%}
    body{
      margin:0; font-family:"Playfair Display",serif; color:var(--text);
      overflow-y:auto;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(255,236,240,0.25), transparent 20%),
        radial-gradient(900px 500px at 95% 85%, rgba(255,240,230,0.18), transparent 18%),
        linear-gradient(160deg, #fff0ef 0%, #ffd6d6 18%, #ffc0be 38%, #ffb3b3 60%, #ffb0b0 100%);
      background-attachment: fixed;
    }

    /* guard: hide content until auth ready */
    html.guard-hide body{ visibility:hidden }
    /* lightweight loader so page isn’t “black” */
    #guardLoader{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      font-family:system-ui, sans-serif; color:#7a2a39; background:transparent; z-index:9999;
    }
    html:not(.guard-hide) #guardLoader{ display:none }

    /* bg layers */
    .bg-grad{position:fixed;inset:0;z-index:0}
    .bg-dither{position:fixed;inset:0;z-index:1;opacity:.12;mix-blend-mode:overlay;
      background:repeating-linear-gradient(0deg,rgba(255,255,255,.03)0px,rgba(255,255,255,.03)2px,rgba(0,0,0,.02)2px,rgba(0,0,0,.02)4px)}
    .bg-layer{position:fixed;inset:0;z-index:2;pointer-events:none}

    .bg-heart{position:absolute;font-size:13px;opacity:.65;text-shadow:0 1px 6px rgba(0,0,0,.25);animation:floatUp linear forwards}
    @keyframes floatUp{0%{transform:translateY(0) scale(1);opacity:.55}100%{transform:translateY(-110vh) scale(1.25);opacity:0}}

    header{padding:26px 18px 10px;text-align:center;position:relative;z-index:6}
    .logo{font-size:40px;color:var(--text);text-shadow:0 2px 10px rgba(0,0,0,.22)}
    .subtag{
      margin-top:6px;
      font-size:14px;
      color:#8b4a55;
      opacity:.9;
      text-shadow:0 1px 6px rgba(255,255,255,.7);
    }

    .page-links{ margin-top:10px; text-align:center; font-size:14px; }
    .page-links a{
      display:inline-block; padding:6px 12px; margin:0 4px; border-radius:16px;
      background:rgba(255,255,255,0.30); color:#5a0013;
      box-shadow:0 4px 8px rgba(0,0,0,0.10);
    }
    .page-links a:hover{ background:rgba(255,255,255,0.40); }

    .wrap{max-width:1120px;margin:10px auto 110px;padding:0 18px;position:relative;z-index:5}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:22px}

    .card{ position:relative;background:var(--panel);border-radius:var(--radius);
           box-shadow:var(--shadow);overflow:hidden;transition:transform .28s cubic-bezier(.2,.9,.3,1) }
    .card:hover{transform:translateY(-6px)}
    .photo{display:block;width:100%;height:auto;object-fit:cover;background:#fff9f7;max-height:460px}
    .meta{padding:12px 14px 16px;text-align:center;font-style:italic;font-size:15px;color:var(--text)}

    .card .soft-heart{position:absolute;pointer-events:none;opacity:.36;animation:softRise 5s ease-in-out infinite;will-change:transform,opacity}
    @keyframes softRise{0%{transform:translateY(6px);opacity:.18}50%{transform:translateY(-6px);opacity:.35}100%{transform:translateY(6px);opacity:.18}}

    .burst{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none}
    .spark{position:absolute;font-size:12px;text-shadow:0 2px 6px rgba(0,0,0,.35);animation:burstMove 1.6s ease-out forwards;opacity:.95}
    @keyframes burstMove{0%{transform:translate(0,0) scale(1);opacity:1}100%{transform:translate(var(--dx),var(--dy)) scale(1.6);opacity:0}}

    #fxCanvas{position:fixed;inset:0;width:100vw;height:100vh;pointer-events:none;z-index:50;}

    /* music ui position override (same as welcome/photo pages) */
    #musicHeartWrap{
      position:fixed;
      right:18px;
      bottom:18px;
      z-index:160;
      display:flex;
      gap:8px;
      align-items:center;
      opacity:.97;
    }
  </style>

  <script>
    // Hide until guard says OK
    document.documentElement.classList.add('guard-hide');
    // Listen for the standard event from guard-auth.js
    window.addEventListener('shree:auth-ready', (e) => {
      const ok = !!(e && e.detail && e.detail.authenticated);
      if (!ok) { location.href = '/index.html'; return; }
      document.documentElement.classList.remove('guard-hide');
    }, { once:true });
    // Failsafe (if event is missed but cookie is already valid, auth-init should sync quickly)
    setTimeout(() => {
      if (document.documentElement.classList.contains('guard-hide')) {
        // last chance – let guard-auth redirect if unauthenticated
        document.documentElement.classList.remove('guard-hide');
      }
    }, 2000);
  </script>
</head>
<body>

  <div id="guardLoader">Loading…</div>

  <div class="bg-grad"></div>
  <div class="bg-dither"></div>
  <div class="bg-layer" id="bgLayer"></div>

  <header>
    <div class="logo">Sweet Memories of Shreshtha's Life</div>
    <div class="subtag">Nine little frames where her favourite smiles live.</div>
    <div class="page-links">
      <a href="gallery.html">Gallery</a>
      <a href="upload.html">Upload</a>
      <a href="/auth/logout">Logout</a>
    </div>
  </header>

  <main class="wrap">
    <section class="grid" id="grid">
      <article class="card"><a href="photo1.html"><img class="photo" src="photos/photo1.jpg" alt=""></a><div class="meta">"A smile is the beauty of the soul."</div></article>
      <article class="card"><a href="photo2.html"><img class="photo" src="photos/photo2.jpg" alt=""></a><div class="meta">"Memories are timeless treasures of the heart."</div></article>
      <article class="card"><a href="photo3.html"><img class="photo" src="photos/photo3.jpg" alt=""></a><div class="meta">"Happiness looks good on you."</div></article>
      <article class="card"><a href="photo4.html"><img class="photo" src="photos/photo4.jpg" alt=""></a><div class="meta">"Collect moments, not things."</div></article>
      <article class="card"><a href="photo5.html"><img class="photo" src="photos/photo5.jpg" alt=""></a><div class="meta">"Every picture tells a story."</div></article>
      <article class="card"><a href="photo6.html"><img class="photo" src="photos/photo6.jpg" alt=""></a><div class="meta">"Smiles are contagious."</div></article>
      <article class="card"><a href="photo7.html"><img class="photo" src="photos/photo7.jpg" alt=""></a><div class="meta">"Joy is the best makeup."</div></article>
      <article class="card"><a href="photo8.html"><img class="photo" src="photos/photo8.jpg" alt=""></a><div class="meta">"A moment lasts all of a second, but the memory lives on forever."</div></article>
      <article class="card"><a href="photo9.html"><img class="photo" src="photos/photo9.jpg" alt=""></a><div class="meta">"Keep smiling, it makes people wonder what you're up to."</div></article>
    </section>
  </main>

  <!-- ambient background hearts -->
  <script>
  (function bgHearts(){
    const host = document.getElementById('bgLayer');
    const colors = ["#ffd6e0","#ffb7c5","#ffd27a","#ffc4a3","#fff0f6"];
    function spawn(){
      const d = document.createElement('div');
      d.className = 'bg-heart';
      d.textContent = '❤';
      d.style.left = (4 + Math.random()*92) + 'vw';
      d.style.bottom = '-20px';
      d.style.fontSize = (8 + Math.random()*20) + 'px';
      d.style.color = colors[Math.floor(Math.random()*colors.length)];
      d.style.animationDuration = (10 + Math.random()*10) + 's';
      host.appendChild(d);
      setTimeout(()=> d.remove(), 22000);
    }
    for(let i=0;i<20;i++) setTimeout(spawn, i*180);
    setInterval(spawn, 900);
  })();
  </script>

  <!-- per-card soft hearts & burst -->
  <script>
  document.querySelectorAll(".card").forEach(card => {
    (function ambient(){
      const n = 4 + (Math.random()*3|0);
      const palette = ["#ffd6e0","#ffb7c5","#ffd27a","#fff0f6"];
      for(let i=0;i<n;i++){
        const s = document.createElement("div");
        s.className = "soft-heart";
        s.textContent = "❤";
        s.style.color = palette[(Math.random()*palette.length)|0];
        s.style.left = (6 + Math.random()*88) + "%";
        s.style.top = (8 + Math.random()*72) + "%";
        s.style.fontSize = (8 + Math.random()*12) + "px";
        s.style.animationDuration = (4 + Math.random()*3) + "s";
        card.appendChild(s);
      }
    })();

    card.addEventListener("mouseenter", () => {
      const burst = document.createElement("div");
      burst.className = "burst"; card.appendChild(burst);
      const pieces = 12;
      const bColors = ["#ffd27a","#ff9fb3","#ffd6e0","#ffc4a3","#ffffffcc"];
      for(let i=0;i<pieces;i++){
        const sp = document.createElement("div");
        sp.className = "spark"; sp.textContent = "❤";
        const angle = Math.random()*Math.PI*2;
        const dist = 50 + Math.random()*90;
        sp.style.setProperty("--dx", Math.cos(angle)*dist + "px");
        sp.style.setProperty("--dy", Math.sin(angle)*(-dist) + "px");
        sp.style.left = "0"; sp.style.top = "0";
        sp.style.fontSize = (9 + Math.random()*12) + "px";
        sp.style.color = bColors[(Math.random()*bColors.length)|0];
        burst.appendChild(sp);
        setTimeout(()=> sp.remove(), 1600);
      }
      setTimeout(()=> burst.remove(), 1700);
    });
  });
  </script>

  <!-- Canvas Hearts -->
  <canvas id="fxCanvas"></canvas>
  <script>
  (function(){
    const c = document.getElementById('fxCanvas'); if (!c) return;
    const ctx = c.getContext('2d');
    const DPR = Math.max(1, window.devicePixelRatio || 1);
    let W=0,H=0, hearts=[];
    const COLORS = ['#dff7ff','#fff9d6','#ffe9d2','#ffdce6','#e9f7e9','#eae8ff','#fff0f6','#fff4de'];
    const R=(a,b)=>Math.random()*(b-a)+a;

    function resize(){ W = Math.floor(innerWidth*DPR); H = Math.floor(innerHeight*DPR);
      c.width = W; c.height = H; c.style.width='100vw'; c.style.height='100vh'; }
    function spawn(){ if (hearts.length > 26) return;
      hearts.push({ x:R(0,W), y:H + R(10*DPR,160*DPR), s:R(14,36),
        vx:R(-6,6), vy:-R(14,36), a:R(.55,.98), r:R(-.5,.5), vr:R(-.012,.012),
        color:COLORS[(Math.random()*COLORS.length)|0] });}
    function draw(px,py,scale,rot,alpha,color){
      ctx.save(); ctx.translate(px,py); ctx.rotate(rot); ctx.scale(scale,scale);
      ctx.globalAlpha = Math.min(1, alpha*1.05);
      const g=ctx.createRadialGradient(0,-0.12,0.05, 0,0.12,1.0);
      g.addColorStop(0,color); g.addColorStop(0.6,color); g.addColorStop(1,'rgba(255,255,255,0.08)');
      ctx.fillStyle=g; ctx.beginPath(); ctx.moveTo(0,-0.5);
      ctx.bezierCurveTo(0.45,-1.05,1.15,-0.05,0,0.8);
      ctx.bezierCurveTo(-1.15,-0.05,-0.45,-1.05,0,-0.5); ctx.fill();
      ctx.restore();
    }
    function tick(){
      ctx.clearRect(0,0,W,H);
      if (Math.random()<0.12) spawn();
      hearts.forEach(h=>{ h.x+=h.vx*0.018; h.y+=h.vy*0.018; h.r+=h.vr; h.a-=0.00095; });
      hearts = hearts.filter(h=> h.y>-160*DPR && h.a>0.02);
      hearts.forEach(h=> draw(h.x,h.y,(h.s/52)*DPR,h.r,h.a,h.color));
      requestAnimationFrame(tick);
    }
    addEventListener('resize', resize, {passive:true});
    resize(); tick();
  })();
  </script>

  <!-- MUSIC (same behaviour as welcome + photo pages) -->
  <audio id="bgMusic" loop preload="auto" style="display:none">
    <source src="/music/bg.mp3" type="audio/mpeg" />
  </audio>

  <div id="musicHeartWrap" aria-hidden="false">
    <button id="musicHeartBtn" aria-label="Toggle background music" title="Play / Pause background music" type="button"
            style="width:56px;height:56px;border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:22px;line-height:1;background:radial-gradient(circle at 30% 30%, #ffd6e0, #ff9fb0);box-shadow:0 8px 28px rgba(220,80,110,0.18);transition:transform .16s ease, box-shadow .16s ease, opacity .18s ease;">
      <span class="heart" aria-hidden="true">♡</span>
    </button>
    <div class="vol-dot" id="musicVolDot" role="button" tabindex="0" aria-label="Volume control" title="Volume"
         style="width:18px;height:18px;border-radius:50%;background:linear-gradient(150deg,#ffd76d,#ffc96a);box-shadow:0 6px 10px rgba(255,170,100,0.22);border:2px solid rgba(255,255,255,0.95);cursor:pointer;margin-left:-8px;"></div>
    <div class="vol-pop" id="musicVolPop" role="dialog" aria-hidden="true"
         style="position:absolute;right:72px;bottom:10px;width:220px;padding:10px 12px;background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,250,248,0.95));border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,0.12);display:none;gap:10px;align-items:center;">
      <div style="font-size:13px;color:#6b2b2b;">Vol</div>
      <input id="musicVolRange" class="vol-range" type="range" min="0" max="100" step="1" value="60" aria-label="Volume slider"
             style="-webkit-appearance:none;width:130px;height:7px;border-radius:999px;background:linear-gradient(90deg,#ffc1c1,#ffd88a);outline:none;">
      <button id="musicMuteBtn"
              style="border:none;background:#fff;padding:6px;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,0.06);cursor:pointer"
              aria-pressed="false" title="Mute/unmute">M</button>
    </div>
  </div>

  <script>
  (function(){
    const audio = document.getElementById('bgMusic');
    const btn = document.getElementById('musicHeartBtn');
    const volDot = document.getElementById('musicVolDot');
    const volPop = document.getElementById('musicVolPop');
    const volRange = document.getElementById('musicVolRange');
    const muteBtn = document.getElementById('musicMuteBtn');
    if(!audio||!btn||!volDot||!volPop||!volRange||!muteBtn) return;

    function updateBtn(){
      const heart = btn.querySelector('.heart');
      if(!heart) return;
      if(!audio.paused){
        btn.style.boxShadow="0 14px 42px rgba(220,80,110,0.28)";
        btn.style.transform="scale(1.04)";
        heart.textContent='❤';
        btn.setAttribute('aria-pressed','true');
      }else{
        btn.style.boxShadow="0 8px 28px rgba(220,80,110,0.18)";
        btn.style.transform="scale(1)";
        heart.textContent='♡';
        btn.setAttribute('aria-pressed','false');
      }
    }

    try{
      const sv = localStorage.getItem('shree_music_volume');
      if(sv!==null){
        const v=Math.max(0,Math.min(100,parseInt(sv,10)));
        audio.volume=v/100;
        volRange.value=v;
      }else audio.volume=0.6;
    }catch(e){ audio.volume=0.6; }

    const savedPlaying = (()=>{ try{return localStorage.getItem('shree_music_playing')==='1';}catch(e){return false;} })();

    btn.addEventListener('click', e=>{
      e.preventDefault();
      if(audio.paused){
        audio.play().then(()=>{
          try{localStorage.setItem('shree_music_playing','1');}catch(e){}
          updateBtn();
        }).catch(()=>{});
      }else{
        audio.pause();
        try{localStorage.setItem('shree_music_playing','0');}catch(e){}
        updateBtn();
      }
    });

    volDot.addEventListener('click', e=>{
      e.stopPropagation();
      const show = volPop.style.display !== 'flex';
      volPop.style.display = show ? 'flex' : 'none';
      volPop.setAttribute('aria-hidden', show ? 'false' : 'true');
      if(show) setTimeout(()=>volRange.focus(), 40);
    });
    volDot.addEventListener('keydown', e=>{
      if(e.key==='Enter'||e.key===' '){ e.preventDefault(); volDot.click(); }
    });

    volRange.addEventListener('input', ()=>{
      const v=Math.max(0,Math.min(100,parseInt(volRange.value||60,10)));
      audio.volume=v/100;
      try{ localStorage.setItem('shree_music_volume', String(v)); }catch(e){}
      muteBtn.setAttribute('aria-pressed', v===0 ? 'true':'false');
    });

    muteBtn.addEventListener('click', ()=>{
      if(audio.volume>0){
        volRange.dataset.prev=volRange.value;
        volRange.value=0;
      }else{
        volRange.value=volRange.dataset.prev||60;
      }
      volRange.dispatchEvent(new Event('input'));
    });

    document.addEventListener('click', e=>{
      if(!e.target.closest('.vol-pop') && !e.target.closest('#musicVolDot')){
        volPop.style.display='none';
        volPop.setAttribute('aria-hidden','true');
      }
    });

    if(savedPlaying){
      audio.play().then(updateBtn).catch(()=>{});
    }
    audio.addEventListener('play', updateBtn);
    audio.addEventListener('pause', updateBtn);
    updateBtn();
  })();
  </script>
</body>
</html>
