<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shreshtha • Memory</title>

  <!-- Correct CSP (note: connect-src fixed) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src 'self' 'unsafe-inline' 'unsafe-eval';
                 connect-src 'self' https:;
                 img-src 'self' data:;
                 style-src 'self' 'unsafe-inline';
                 media-src 'self';">

  <style>
    :root{
      --bg1:#fff0ef; --bg2:#ffd6d6; --ink:#5a0013;
      --card:rgba(255,255,255,.62); --shadow:0 18px 40px rgba(0,0,0,.18);
      --pill:#f8d2da; --pill-text:#6b2a3a; --radius:22px; --accent:#6d2a47;
    }
    *{box-sizing:border-box} html,body{height:100%;margin:0}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color: var(--ink);
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(255,236,240,0.25), transparent 20%),
        radial-gradient(900px 500px at 95% 85%, rgba(255,240,230,0.18), transparent 18%),
        linear-gradient(160deg, var(--bg1), var(--bg2));
      background-attachment: fixed;
      text-align: center;
    }
    header{padding:24px 14px 10px}
    h1{margin:0;font-family: ui-serif, Georgia, serif; font-size: clamp(26px,5vw,40px)}
    .wrap{max-width:1150px;margin:0 auto;padding:0 18px 50px}
    .frame{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
           overflow:hidden;padding:14px}
    .hero{width:100%;height:72vh;min-height:420px;object-fit:cover;display:block;background:#fff;border-radius:16px}
    .cap-area{display:flex;justify-content:center;margin-top:12px}
    .cap{background:var(--pill);color:var(--pill-text);padding:8px 14px;border-radius:999px;
         font-style:italic;font-size:15px;box-shadow:0 10px 22px rgba(0,0,0,.08)}
    .links{margin:16px 0 8px;font-size:15px}
    .links a{color:var(--accent);text-decoration:none;font-weight:600}
    .links .sep{opacity:.6;margin:0 8px}
    .actions{margin-top:12px}
    .pill{display:inline-block;margin:0 6px 8px;padding:8px 14px;border-radius:999px;
          background:var(--card);text-decoration:none;color:var(--ink);font-weight:600;
          box-shadow:0 8px 20px rgba(0,0,0,.08)}
    .pill.primary{background:var(--accent);color:#fff}

    /* side heart nav */
    .nav-heart{position:fixed;top:50%;transform:translateY(-50%);font-size:42px;
               text-decoration:none;z-index:5;opacity:.9;user-select:none}
    .nav-heart:hover{transform:translateY(-50%) scale(1.06)}
    .nav-left{left:16px} .nav-right{right:16px}
  </style>
</head>
<body>

  <!-- top text links -->
  <div class="links">
    <a href="life.html">Life</a><span class="sep">|</span>
    <a href="gallery.html">Gallery</a><span class="sep">|</span>
    <a href="upload.html">Upload</a><span class="sep">|</span>
    <a href="/logout.html">Logout</a>
  </div>

  <!-- side navigation hearts -->
  <a id="prevHeart" class="nav-heart nav-left" href="photo8.html" aria-label="Previous">❤</a>
  <a id="nextHeart" class="nav-heart nav-right" href="life.html" aria-label="Next">❤</a>

  <header><h1>Memory</h1></header>

  <main class="wrap">
    <article class="frame">
      <!-- If you use Drive, swap to /api/file/<id>.  Static: keep /photos/photo9.jpg -->
      <img class="hero" src="/photos/photo9.jpg" alt="Memory 9" />
      <div class="cap-area"><span class="cap">“A little sparkle of joy.”</span></div>

      <div class="actions">
        <a class="pill" href="/gallery.html">Back to Gallery</a>
        <a class="pill primary" href="/life.html">Sweet Memories</a>
        <a class="pill" href="/auth/logout">Logout</a>
      </div>
    </article>
  </main>

  <!-- prev/next hrefs based on file name -->
  <script>
    (function(){
      const m = (location.pathname||'').match(/photo(\d+)\.html/i);
      const total = 9;
      if(!m) return;
      const cur = parseInt(m[1],10);
      const prev = cur>1 ? cur-1 : total;
      const next = cur<total ? cur+1 : 1;
      const prevLink = document.getElementById('prevHeart');
      const nextLink = document.getElementById('nextHeart');
      if(prevLink) prevLink.href = 'photo'+prev+'.html';
      if(nextLink) nextLink.href = 'photo'+next+'.html';
    })();
  </script>

  <!-- Single hearts effect (keep just this; remove other duplicate heart scripts) -->
  <script src="/hearts.js" defer></script>

  <!-- Single, clean music control -->
  <style>
    #musicHeartWrap{position:fixed;right:18px;bottom:18px;z-index:9999;display:flex;gap:8px;align-items:center}
    #musicHeartBtn{width:56px;height:56px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:22px;
      background:radial-gradient(circle at 30% 30%,#ffd6e0,#ff9fb0);box-shadow:0 8px 28px rgba(220,80,110,.14);transition:transform .16s ease,box-shadow .16s ease}
    #musicHeartBtn:active{transform:scale(.96)}
    #musicHeartBtn.playing{box-shadow:0 14px 42px rgba(220,80,110,.24);transform:scale(1.04)}
    #musicHeartBtn .heart{pointer-events:none;user-select:none}
    .vol-dot{width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(150deg,#ffd76d,#ffc96a);
      box-shadow:0 6px 10px rgba(255,170,100,.18);border:2px solid rgba(255,255,255,.9);cursor:pointer;margin-left:-8px}
    .vol-pop{position:absolute;right:72px;bottom:10px;width:220px;padding:10px 12px;background:linear-gradient(180deg,rgba(255,255,255,.98),rgba(255,250,248,.95));
      border-radius:12px;box-shadow:0 12px 30px rgba(0,0,0,.12);display:none;gap:10px;align-items:center}
    .vol-pop.show{display:flex}
    .vol-range{-webkit-appearance:none;width:130px;height:7px;border-radius:999px;background:linear-gradient(90deg,#ffc1c1,#ffd88a);outline:none}
    .vol-range::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,.12);border:3px solid #ffb0a0}
  </style>

  <audio id="bgMusicFinal" loop preload="auto" style="display:none">
    <source src="/music/bg.mp3" type="audio/mpeg" />
  </audio>

  <div id="musicHeartWrap" aria-hidden="false">
    <button id="musicHeartBtn" aria-label="Toggle background music" title="Play / Pause background music" type="button">
      <span class="heart" aria-hidden="true">♡</span>
    </button>
    <div class="vol-dot" id="musicVolDot" role="button" tabindex="0" aria-label="Volume control" title="Volume"></div>

    <div class="vol-pop" id="musicVolPop" role="dialog" aria-hidden="true">
      <div style="font-size:13px;color:#6b2b2b;">Vol</div>
      <input id="musicVolRange" class="vol-range" type="range" min="0" max="100" step="1" value="60" aria-label="Volume slider" />
      <button id="musicMuteBtn" style="border:none;background:#fff;padding:6px;border-radius:8px;box-shadow:0 4px 8px rgba(0,0,0,.06);cursor:pointer" aria-pressed="false" title="Mute/unmute">M</button>
    </div>
  </div>

  <script>
    (function(){
      const audio = document.getElementById('bgMusicFinal');
      const btn = document.getElementById('musicHeartBtn');
      const volDot = document.getElementById('musicVolDot');
      const volPop = document.getElementById('musicVolPop');
      const volRange = document.getElementById('musicVolRange');
      const muteBtn = document.getElementById('musicMuteBtn');
      if(!audio||!btn||!volDot||!volPop||!volRange||!muteBtn) return;

      try {
        const savedVol = localStorage.getItem('shree_music_volume');
        if (savedVol !== null) volRange.value = savedVol;
        audio.volume = (savedVol !== null) ? Math.max(0, Math.min(100, parseInt(savedVol,10)))/100 : 0.6;
      } catch(e){}

      function updateBtn(){
        const heart = btn.querySelector('.heart');
        if(!heart) return;
        if(!audio.paused){ btn.classList.add('playing'); heart.textContent='❤'; btn.setAttribute('aria-pressed','true'); }
        else{ btn.classList.remove('playing'); heart.textContent='♡'; btn.setAttribute('aria-pressed','false'); }
      }

      btn.addEventListener('click', e=>{
        e.preventDefault();
        if(audio.paused){
          audio.play().then(()=>{ localStorage.setItem('shree_music_playing','1'); updateBtn(); }).catch(()=>{});
        }else{
          audio.pause(); localStorage.setItem('shree_music_playing','0'); updateBtn();
        }
      });

      volDot.addEventListener('click', e=>{
        e.stopPropagation();
        const show = volPop.classList.toggle('show');
        volPop.setAttribute('aria-hidden', show ? 'false' : 'true');
        if(show) setTimeout(()=>volRange.focus(),40);
      });
      volDot.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); volDot.click(); } });

      function applyVol(){
        const v = Math.max(0, Math.min(100, parseInt(volRange.value,10)));
        audio.volume = v/100;
        try{ localStorage.setItem('shree_music_volume', String(v)); }catch(e){}
        muteBtn.setAttribute('aria-pressed', v===0 ? 'true' : 'false');
      }
      volRange.addEventListener('input', applyVol);
      applyVol();

      muteBtn.addEventListener('click', ()=>{
        if(audio.volume>0){ volRange.dataset.prev = volRange.value; volRange.value = 0; }
        else{ volRange.value = volRange.dataset.prev || 60; }
        volRange.dispatchEvent(new Event('input'));
      });

      document.addEventListener('click', e=>{
        if(!e.target.closest('.vol-pop') && !e.target.closest('#musicVolDot')){
          volPop.classList.remove('show'); volPop.setAttribute('aria-hidden','true');
        }
      });

      audio.addEventListener('play', updateBtn);
      audio.addEventListener('pause', updateBtn);
      audio.addEventListener('volumechange', ()=> {
        try{ localStorage.setItem('shree_music_volume', String(Math.round(audio.volume*100))); }catch(e){}
      });

      // try auto-resume after first user gesture if blocked
      audio.play().then(updateBtn).catch(()=>{
        const start=()=>{ audio.play().then(()=>{ localStorage.setItem('shree_music_playing','1'); updateBtn(); }).catch(()=>{}); cleanup(); };
        const cleanup=()=>{ window.removeEventListener('click',start,{capture:true}); window.removeEventListener('touchstart',start,{passive:true}); window.removeEventListener('keydown',start,{capture:true}); };
        window.addEventListener('click',start,{capture:true});
        window.addEventListener('touchstart',start,{passive:true});
        window.addEventListener('keydown',start,{capture:true});
      });
      updateBtn();
    })();
  </script>
</body>
</html>
