
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>shreshthapushkar — Login</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Auth0 SPA lib from CDN -->
  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.22/auth0-spa-js.production.js"></script>

  <!-- IMPORTANT: set values to the Auth0 Application that is paired with the backend API -->
  <script>
    window.AUTH0_DOMAIN = 'dev-zzhjbmtzoxtgoz31.us.auth0.com';
    // Use the Client ID that is paired with the API https://shree-drive.onrender.com
    window.AUTH0_CLIENT_ID = '6sfOCkf0BFVHsuzfPJCHoLDffZSNJjzT';
    window.AUTH0_AUDIENCE = 'https://shree-drive.onrender.com';
  </script>

  <!-- Auth init + guard (must exist in repo root) -->
  <script src="/auth-init.js"></script>
  <script src="/guard-auth.js"></script>

  <style>
    :root{--bg:#f6f4ee;--card:#fff;--primary:#2b6cb0}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial}
    body{display:flex;align-items:center;justify-content:center;background:var(--bg)}
    .card{background:var(--card);padding:28px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.08);max-width:460px;width:92%;text-align:center}
    h1{margin:0 0 8px;font-size:22px}
    .muted{color:#666;margin-bottom:16px}
    button{background:var(--primary);color:#fff;border:0;padding:10px 18px;border-radius:8px;font-weight:600;cursor:pointer}
    button:active{transform:translateY(1px)}
    #status{margin-top:12px;color:#444;font-size:14px}
    .small{font-size:13px;color:#888;margin-top:10px}
  </style>
</head>
<body>
  <main class="card" role="main" aria-labelledby="page-title">
    <h1 id="page-title">Login to view Shreshtha's Memories</h1>
    <p class="muted">Private, invite-only — use an approved email.</p>

    <button id="btn-login" aria-label="Login with Auth0">Login with Auth0</button>
    <div id="status" role="status" aria-live="polite"></div>
    <p class="small">If you get redirected back to this page, check that you're using an approved email in the invite list.</p>
  </main>

  <script>
    const btn = document.getElementById('btn-login');
    const status = document.getElementById('status');

    btn.addEventListener('click', async () => {
      try {
        btn.disabled = true;
        status.textContent = 'Redirecting to Auth0…';
        await auth0Login(); // provided by /auth-init.js
      } catch (err) {
        console.error('Login error', err);
        status.textContent = 'Login failed: ' + (err && err.message ? err.message : 'unknown');
        btn.disabled = false;
      }
    });

    // If the page loaded with an active session already, redirect to life.html
    (async function checkAlready() {
      try {
        // initAuth0 may take a moment
        if (window.initAuth0) await window.initAuth0();
        if (window.isAuthenticated) {
          const authed = await window.isAuthenticated();
          if (authed) {
            // small delay so user sees status before redirect (optional)
            status.textContent = 'Already logged in — redirecting…';
            setTimeout(()=> window.location.replace('/life.html'), 400);
          }
        }
      } catch (e) {
        // ignore, user can click login
        console.debug('session check error', e);
      }
    })();
  </script>
</body>
</html>
