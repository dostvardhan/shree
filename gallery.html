<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Gallery â€¢ Shreshtha</title>
  <style>
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#3b3f2d;color:#fff;}
    h1{text-align:center;padding:18px;color:#f7cfe0;}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;padding:18px;max-width:1100px;margin:0 auto;}
    .card{overflow:hidden;border-radius:10px;box-shadow:0 6px 16px rgba(0,0,0,.3);height:180px;}
    .card img{width:100%;height:100%;object-fit:cover;transition:transform .35s;}
    .card:hover img{transform:scale(1.05);}
    #protected{display:none;}
    #logout{position:fixed;top:14px;right:14px;padding:6px 10px;border-radius:6px;background:#f76ca2;color:#fff;border:none;cursor:pointer;}
  </style>

  <script src="https://cdn.auth0.com/js/auth0-spa-js/1.19/auth0-spa-js.production.js" defer></script>
  <script defer>
  (function(){
    const AUTH0_DOMAIN="dev-zzhjbmtzoxtgoz31.us.auth0.com";
    const AUTH0_CLIENT_ID="0glcwUr7ZZ9sbBTBPiUPahEqqwUcuzfR";
    const AUTH0_AUDIENCE="https://shree-drive.onrender.com";
    window.__AUTH_READY__=(async function(){
      const a = await createAuth0Client({domain:AUTH0_DOMAIN,client_id:AUTH0_CLIENT_ID,audience:AUTH0_AUDIENCE,cacheLocation:'memory'});
      return window.__AUTH__ = { _auth0: a, isAuthenticated: ()=>a.isAuthenticated(), login: ()=>a.loginWithRedirect({redirect_uri:window.location.href}), logout: ()=>a.logout({returnTo:window.location.origin}), getUser: ()=>a.getUser(), authFetch: async(u,o={})=>{ const t=await a.getTokenSilently(); const h=new Headers(o.headers||{}); if(t) h.set('Authorization','Bearer '+t); return fetch(u,{...o,headers:h,credentials:'include'}); } };
    })();
  })();
  </script>
</head>
<body>
  <div id="protected">
    <h1>Gallery</h1>
    <div class="grid" id="grid"></div>
    <button id="logout">Logout</button>
  </div>

  <script>
  (async function(){
    const auth = await window.__AUTH_READY__;
    if(!await auth.isAuthenticated()){ await auth.login(); return; }
    document.getElementById('protected').style.display='block';
    document.getElementById('logout').onclick=()=>auth.logout();

    const res = await auth.authFetch('https://shree-drive.onrender.com/list');
    if(!res.ok){ console.error('list err', res.status); return; }
    const json = await res.json();
    const files = json.files || [];
    const grid = document.getElementById('grid');
    for(const f of files){
      try{
        const r = await auth.authFetch(`https://shree-drive.onrender.com/files/${f.id}`);
        if(!r.ok) { console.warn('file fetch fail', f.id); continue; }
        const blob = await r.blob();
        const url = URL.createObjectURL(blob);
        const card = document.createElement('div'); card.className='card';
        const img = document.createElement('img'); img.src=url; img.alt=f.name||'';
        card.appendChild(img); grid.appendChild(card);
        img.onload = ()=>URL.revokeObjectURL(url);
      }catch(e){ console.error(e); }
    }
  })();
  </script>
</body>
</html>
