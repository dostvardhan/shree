<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gallery</title>
  <link rel="stylesheet" href="style.css">
  <script src="/auth0-spa-js.production.js"></script>
  <script>
    let auth0Client;

    async function initAuth0() {
      auth0Client = await createAuth0Client({
        domain: "dev-zzhjbmtzoxtgoz31.us.auth0.com",
        client_id: "0glcwUr7ZZ9sbBTBPiUPahEqqwUcuzfR",
        audience: "https://shree-drive.onrender.com",
        cacheLocation: "localstorage",
        useRefreshTokens: true,
        redirect_uri: window.location.origin + "/welcome.html"
      });

      const isAuthenticated = await auth0Client.isAuthenticated();
      if (!isAuthenticated) return window.location.href = "/index.html";

      const token = await auth0Client.getTokenSilently({ audience: "https://shree-drive.onrender.com" });
      const resp = await fetch("https://shree-drive.onrender.com/api/list", {
        headers: { Authorization: "Bearer " + token }
      });
      const data = await resp.json();
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = "";
      for (const f of data.files) {
        const r = await fetch(`https://shree-drive.onrender.com/api/file/${f.id}`, {
          headers: { Authorization: "Bearer " + token }
        });
        const blob = await r.blob();
        const url = URL.createObjectURL(blob);
        const img = document.createElement("img");
        img.src = url;
        img.alt = f.name;
        img.classList.add("thumb");
        gallery.appendChild(img);
      }
    }

    window.onload = initAuth0;
  </script>
</head>
<body>
  <h1>Gallery</h1>
  <div id="gallery" class="photo-grid">Loading...</div>
</body>
</html>
