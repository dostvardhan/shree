<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Gallery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./style.css" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:#f7f7f8;margin:0}
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
    h1{margin:0 0 16px}
    .actions{display:flex;gap:8px;align-items:center;margin-bottom:16px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.06);overflow:hidden;display:flex;flex-direction:column}
    .media{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;background:#fafafa;overflow:hidden}
    .media img{width:100%;height:100%;object-fit:cover;display:block}
    .meta{padding:10px 12px}
    .name{font-size:14px;font-weight:600;line-height:1.3}
    .caption{font-size:13px;opacity:.85;margin-top:6px}
    .row{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .btn{font-size:13px;border:1px solid #ddd;border-radius:10px;background:#fff;padding:6px 10px;text-decoration:none}
    .muted{opacity:.7}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Gallery</h1>
    <div class="actions">
      <a class="btn" href="/upload.html">+ Upload more</a>
      <span id="status" class="muted"></span>
    </div>

    <div id="gallery" class="grid"></div>
  </div>

  <script>
    const API = "https://shree-drive.onrender.com";

    // Optional: custom captions
    const captionById = {
      // "1AbCdEF...": "“Yeh hamari yaadon ka rang hai.”",
    };
    const captionByName = {
      // "photo2.jpg": "“Jahan dil lage, wahi ghar hai.”"
    };
    // Default caption for the 2nd photo (index 1)
    const defaultSecondCaption = "“Jahan dil lage, wahi ghar hai.”";

    function getCaption(file, index) {
      if (captionById[file.id]) return captionById[file.id];
      if (captionByName[file.name]) return captionByName[file.name];
      if (index === 1) return defaultSecondCaption; // 2nd card
      return "";
    }

    async function loadGallery() {
      const status = document.getElementById("status");
      const wrap = document.getElementById("gallery");
      status.textContent = "Loading…";

      try {
        const res = await fetch(`${API}/list?limit=100`);
        const data = await res.json();

        if (!res.ok || !data.ok) {
          status.textContent = "Failed to load.";
          return;
        }

        wrap.innerHTML = data.files.map((f, i) => {
          const cap = getCaption(f, i);
          const view = f.webViewLink || f.viewSrc;
          const dl = f.webContentLink;
          const img = f.thumb || f.viewSrc;

          return `
            <div class="card">
              <a class="media" href="${view}" target="_blank" rel="noopener">
                <img src="${img}" alt="${f.name}" loading="lazy" />
              </a>
              <div class="meta">
                <div class="name" title="${f.name}">${f.name}</div>
                ${cap ? `<div class="caption">${cap}</div>` : ""}
                <div class="row">
                  <a class="btn" href="${view}" target="_blank" rel="noopener">View</a>
                  <a class="btn" href="${dl}" target="_blank" rel="noopener">Download</a>
                </div>
              </div>
            </div>
          `;
        }).join("");

        status.textContent = `${data.files.length} photos`;
      } catch (e) {
        console.error(e);
        status.textContent = "Error loading gallery.";
      }
    }

    loadGallery();
  </script>
</body>
</html>
