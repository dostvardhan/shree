<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Upload Photo</title>
  <link rel="stylesheet" href="./style.css" />
  <style>
    body{background:#f7f7f8;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;margin:0}
    .card{max-width:560px;margin:40px auto;padding:24px;border-radius:16px;background:#fff;box-shadow:0 10px 30px rgba(0,0,0,.08)}
    h2{margin:0 0 6px}
    .muted{opacity:.75;font-size:.95rem}
    .row{margin:12px 0}
    .btn{padding:10px 16px;border:none;border-radius:10px;cursor:pointer}
    .btn-primary{background:#111;color:#fff}
    pre{background:#f6f6f6;padding:12px;border-radius:10px;overflow:auto}
    #link a{word-break:break-all}
    .thumb{display:block;max-width:240px;width:100%;margin-top:10px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .btn-ghost{background:#fff;border:1px solid #ddd}
  </style>
</head>
<body>
  <div class="card">
    <h2>Upload a Photo</h2>
    <p class="muted">Choose an image and click Upload. File goes to Google Drive.</p>

    <form id="uploadForm" class="row" enctype="multipart/form-data">
      <input type="file" id="fileInput" name="file" accept="image/*" required />
      <button class="btn btn-primary" type="submit" id="btnUpload">Upload</button>
    </form>

    <div class="toolbar">
      <a class="btn btn-ghost" href="/gallery.html">Open Gallery</a>
      <a class="btn btn-ghost" href="/">Home</a>
    </div>

    <div id="status" class="row muted"></div>
    <div id="link" class="row"></div>
    <pre id="json" class="row" hidden></pre>
  </div>

  <script>
    const ENDPOINT = "https://shree-drive.onrender.com/upload";

    const form = document.getElementById("uploadForm");
    const fileInput = document.getElementById("fileInput");
    const statusEl = document.getElementById("status");
    const jsonEl = document.getElementById("json");
    const linkEl = document.getElementById("link");
    const btn = document.getElementById("btnUpload");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      linkEl.innerHTML = "";
      jsonEl.hidden = true;

      if (!fileInput.files.length) {
        statusEl.textContent = "Please select a file.";
        return;
      }

      const fd = new FormData();
      fd.append("file", fileInput.files[0]);

      btn.disabled = true;
      statusEl.textContent = "Uploading‚Ä¶";

      try {
        const res = await fetch(ENDPOINT, { method: "POST", body: fd });
        const data = await res.json().catch(() => ({}));
        jsonEl.textContent = JSON.stringify(data, null, 2);
        jsonEl.hidden = false;

        if (res.ok && data?.ok) {
          statusEl.textContent = "Upload successful ‚úÖ";
          const v = data.file || {};

          // Links + controls
          const view = v.webViewLink || "#";
          const dl = v.webContentLink || "#";
          linkEl.innerHTML = `
            <div>View: <a href="${view}" target="_blank" rel="noopener">${view}</a></div>
            <div>Download: <a href="${dl}" target="_blank" rel="noopener">${dl}</a></div>
          `;

          // Copy button
          if (v.webViewLink) {
            const copyBtn = document.createElement("button");
            copyBtn.className = "btn btn-ghost";
            copyBtn.textContent = "Copy View Link";
            copyBtn.onclick = async () => {
              try { await navigator.clipboard.writeText(v.webViewLink); copyBtn.textContent = "Copied!"; }
              catch { copyBtn.textContent = "Copy failed"; }
              setTimeout(() => (copyBtn.textContent = "Copy View Link"), 1200);
            };
            linkEl.appendChild(copyBtn);
          }

          // Thumbnail preview
          if (v.id) {
            const img = document.createElement("img");
            img.className = "thumb";
            img.alt = v.name || "Uploaded image";
            img.loading = "lazy";
            img.src = `https://drive.google.com/thumbnail?id=${v.id}`;
            linkEl.appendChild(img);
          }

          // üëâ Auto-redirect to Gallery after 2s (with cache-bust)
          setTimeout(() => {
            window.location.href = "/gallery.html?v=" + Date.now();
          }, 2000);

        } else {
          statusEl.textContent = "Upload failed ‚ùå";
        }
      } catch (err) {
        statusEl.textContent = "Network error ‚ùå";
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
