<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Upload Photo</title>
  <link rel="stylesheet" href="./style.css" />
  <style>
    .card{max-width:520px;margin:40px auto;padding:24px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08);background:#fff}
    .row{margin:12px 0}
    .btn{padding:10px 16px;border:none;border-radius:10px;cursor:pointer}
    .btn-primary{background:#111;color:#fff}
    .muted{opacity:.75;font-size:.9rem}
    pre{background:#f6f6f6;padding:12px;border-radius:10px;overflow:auto}
    #link a{word-break:break-all}
  </style>
</head>
<body>
  <div class="card">
    <h2>Upload a Photo</h2>
    <p class="muted">Choose an image and click Upload. File goes to Google Drive.</p>

    <form id="uploadForm" class="row" enctype="multipart/form-data">
      <input type="file" id="fileInput" name="file" accept="image/*" required />
      <button class="btn btn-primary" type="submit" id="btnUpload">Upload</button>
    </form>

    <div id="status" class="row muted"></div>
    <div id="link" class="row"></div>
    <pre id="json" class="row" hidden></pre>
  </div>

  <script>
    const ENDPOINT = "https://shree-drive.onrender.com/upload";

    const form = document.getElementById("uploadForm");
    const fileInput = document.getElementById("fileInput");
    const statusEl = document.getElementById("status");
    const jsonEl = document.getElementById("json");
    const linkEl = document.getElementById("link");
    const btn = document.getElementById("btnUpload");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      linkEl.innerHTML = "";
      jsonEl.hidden = true;

      if (!fileInput.files.length) {
        statusEl.textContent = "Please select a file.";
        return;
      }

      const fd = new FormData();
      fd.append("file", fileInput.files[0]);

      btn.disabled = true;
      statusEl.textContent = "Uploading…";

      try {
        const res = await fetch(ENDPOINT, {
          method: "POST",
          body: fd
        });

        const data = await res.json().catch(() => ({}));

        jsonEl.textContent = JSON.stringify(data, null, 2);
        jsonEl.hidden = false;

        if (res.ok && data?.ok) {
          statusEl.textContent = "Upload successful ✅";
          const v = data.file || {};
          if (v.webViewLink || v.webContentLink) {
            linkEl.innerHTML = `
              <div>View: <a href="${v.webViewLink || '#'}" target="_blank" rel="noopener">${v.webViewLink || '(no link)'}</a></div>
              <div>Download: <a href="${v.webContentLink || '#'}" target="_blank" rel="noopener">${v.webContentLink || '(no link)'}</a></div>
            `;
          }
        } else {
          statusEl.textContent = "Upload failed ❌";
        }
      } catch (err) {
        statusEl.textContent = "Network error ❌";
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
