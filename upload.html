<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upload Photo â€” Shreshtha</title>

<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<style>
body {
    margin:0;
    font-family: Arial, sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    background: linear-gradient(135deg,#f2f9ff,#fff7f3);
}

.card {
    background: rgba(255,255,255,0.95);
    padding: 30px;
    border-radius: 12px;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    text-align: center;
}

h1 { margin-bottom: 15px; color: #184a5a; }
input[type="file"], input[type="text"] {
    width: 100%; padding: 8px; margin: 8px 0; border-radius:6px; border:1px solid #ccc;
}
button {
    padding:10px 18px; border:none; border-radius:8px;
    background:linear-gradient(90deg,#8fbf9b,#6b8f5a); color:white; font-weight:600;
    cursor:pointer;
}
#status { margin-top:12px; color:#555; font-weight:500; }
a { display:block; margin-top:12px; text-decoration:none; color:#184a5a; }
</style>
</head>
<body>

<div class="card">
    <h1>Upload a Photo</h1>
    <form id="uploadForm">
        <input type="file" id="fileInput" name="file" required>
        <input type="text" id="captionInput" name="caption" placeholder="Caption (optional)">
        <button type="submit">Upload</button>
    </form>
    <div id="status"></div>
    <a href="/life.html">Back to Life Gallery</a>
</div>

<script>
window.addEventListener('load', () => {
    if (!window.netlifyIdentity) return location.href = '/';
    netlifyIdentity.init();
    const user = netlifyIdentity.currentUser();
    if (!user) location.href = '/';
});

document.getElementById('uploadForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const fileInput = document.getElementById('fileInput');
    const captionInput = document.getElementById('captionInput');
    const status = document.getElementById('status');

    if (!fileInput.files[0]) return alert('Please select a file');

    const formData = new FormData();
    formData.append('file', fileInput.files[0]);
    formData.append('caption', captionInput.value);

    status.innerText = 'Uploading...';

    try {
        const res = await fetch('/.netlify/functions/upload', {
            method: 'POST',
            body: formData
        });

        if (!res.ok) throw new Error(await res.text());

        const data = await res.json();
        status.innerText = 'Upload successful!';
        console.log(data);
    } catch (err) {
        status.innerText = 'Error: ' + err.message;
        console.error(err);
    }
});
</script>

</body>
</html>
