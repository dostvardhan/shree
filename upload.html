<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Shree • Upload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  <script>
    const BACKEND = "https://shree-drive.onrender.com";
    const API_URL = "https://shreshthapushkar.com/.netlify/identity";

    function requireLogin() {
      if (!window.netlifyIdentity) {
        alert("Identity widget not loaded");
        return;
      }
      window.netlifyIdentity.init({ APIUrl: API_URL });
      window.netlifyIdentity.on("init", u => { if (!u) window.location.replace("/"); });
    }

    async function token() {
      const u = window.netlifyIdentity.currentUser();
      if (!u) throw new Error("Not logged in");
      return await u.jwt();
    }

    async function doUpload() {
      const status = document.getElementById("status");
      const file = document.getElementById("file").files[0];
      if (!file) return alert("Select a file first");

      status.textContent = "Uploading…";
      try {
        const t = await token();
        const form = new FormData();
        form.append("file", file);
        const r = await fetch(`${BACKEND}/upload`, {
          method: "POST",
          headers: { Authorization: `Bearer ${t}` },
          body: form
        });
        const data = await r.json();
        if (!r.ok) throw new Error(data.error || "Upload failed");
        status.textContent = "✅ Uploaded: " + data.name;
      } catch (e) {
        status.textContent = "❌ " + e.message;
      }
    }

    function logout(){ window.netlifyIdentity.logout(); window.location.replace("/"); }
    document.addEventListener("DOMContentLoaded", requireLogin);
  </script>
  <style>
    body{ font-family:system-ui; margin:0; padding:16px; }
    header{ display:flex; align-items:center; gap:10px; margin-bottom:20px; }
    input[type=file]{ margin:10px 0; }
    button{ padding:8px 14px; border-radius:8px; border:1px solid #ccc; cursor:pointer; }
    #status{ margin-top:12px; color:#333; }
  </style>
</head>
<
