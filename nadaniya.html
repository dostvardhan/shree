<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nadaniya Gallery</title>
<link rel="stylesheet" href="/style.css">
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    text-align:center;
    background: linear-gradient(135deg, #f8f0e1, #fce1f0);
    color: #4b3f2f;
    margin: 0;
    padding: 0;
  }
  h1 { margin-top: 30px; font-size: 36px; color:#ff6f61;}
  a.back {
    position: fixed; top: 20px;
    font-size: 20px; color: #ff6f61; text-decoration: none;
  }
  a.back:first-of-type { left: 20px; }
  a.back:last-of-type { right: 20px; }
  #gallery { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin-top: 70px; }
  .photo-card { position:relative; width:300px; overflow:hidden; border-radius:15px; box-shadow:0 0 25px rgba(0,0,0,0.2); transition: transform 0.5s, box-shadow 0.5s; }
  .photo-card img { width:100%; display:block; transition: transform 0.5s; }
  .photo-card:hover { transform: scale(1.03); box-shadow:0 0 50px rgba(0,0,0,0.3); }
  .quote { 
    position:absolute; bottom:10px; left:0; width:100%; 
    color:white; background:rgba(0,0,0,0.4); 
    padding:10px; font-size:18px; opacity:0; transform: translateY(20px); 
    transition: opacity 0.5s, transform 0.5s; 
  }
  .photo-card:hover .quote { opacity:1; transform: translateY(0); }

  form { margin-top: 40px; display:flex; flex-direction:column; align-items:center; gap:10px;}
  input, textarea, button {
    font-size: 18px; padding:10px; border-radius:10px; border:1px solid #ccc; width: 300px;
  }
  button { cursor:pointer; background:#ff6f61; color:white; border:none; transition:0.3s; }
  button:hover { background:#ff4a3c; }
</style>
</head>
<body>

<!-- Back buttons -->
<a class="back" href="photo9.html">&#8592; Back to Photo9</a>
<a class="back" href="life.html">&#8592; Back to Life</a>

<h1>Nadaniya Gallery</h1>

<div id="gallery">Loading...</div>

<form id="uploadForm">
  <h2>Upload New Photo</h2>
  <input type="file" name="photo" required accept="image/*">
  <textarea name="quote" placeholder="Enter quote for photo" required></textarea>
  <button type="submit">Upload</button>
</form>

<script>
if (window.netlifyIdentity) {
  window.netlifyIdentity.on('init', user => {
    if (!user) {
      window.location.href = "/";
    }
  });
  window.netlifyIdentity.init();
}

async function loadGallery() {
  const res = await fetch('/.netlify/functions/cloudPosts');
  const posts = await res.json();
  const container = document.getElementById('gallery');
  container.innerHTML = '';
  posts.forEach(p => {
    const div = document.createElement('div');
    div.className = 'photo-card';
    div.innerHTML = `<img src="${p.photo}" alt="Daily Photo"><div class="quote">${p.quote}</div>`;
    container.appendChild(div);
  });
}
loadGallery();

document.getElementById('uploadForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const formData = new FormData(e.target);
  const res = await fetch('/.netlify/functions/upload', {
    method: 'POST',
    body: formData
  });
  if(res.ok){
    alert('Photo uploaded!');
    e.target.reset();
    loadGallery();
  } else {
    alert('Upload failed.');
  }
});
</script>

</body>
</html>
