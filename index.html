<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Shree • Welcome</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; display:grid; place-items:center; min-height:100dvh; background:#fafafa; }
    .card { width:min(520px,90%); background:#fff; padding:24px; border:1px solid #eee; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.05); }
    .row{ display:flex; gap:12px; flex-wrap:wrap; margin-top:12px; }
    button{ padding:12px 16px; border-radius:12px; border:1px solid #ddd; background:#fff; cursor:pointer; }
    #debug{ margin-top:10px; font-size:12px; color:#666; white-space:pre-wrap; }
  </style>

  <!-- Use the official CDN for the widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <script>
    const API_URL = 'https://shreshthapushkar.com/.netlify/identity';

    function log(m){ const el = document.getElementById('debug'); if (el) el.textContent = m; }

    async function checkIdentityHealth(){
      try {
        const r = await fetch(API_URL + '/health', { cache: 'no-store' });
        log(`Identity health: ${r.status} ${r.statusText}`);
      } catch (e) {
        log('Identity health check failed: ' + e.message);
      }
    }

    function setupIdentity(){
      if (!window.netlifyIdentity) {
        log('❌ netlifyIdentity object missing (CDN failed to load?)');
        return;
      }

      // Point the widget at YOUR domain’s Identity endpoint
      window.netlifyIdentity.init({ APIUrl: API_URL });

      window.netlifyIdentity.on('init', (user) => {
        log(user ? 'Already logged in → redirecting…' : 'Identity ready.');
        if (user) location.replace('/life.html');
      });
      window.netlifyIdentity.on('login', () => location.replace('/life.html'));
      window.netlifyIdentity.on('signup', () => location.replace('/life.html'));
    }

    function openLogin(){
      if (!window.netlifyIdentity) return log('❌ Identity not loaded.');
      try { window.netlifyIdentity.open('login'); }
      catch(e){ window.netlifyIdentity.init({ APIUrl: API_URL }); setTimeout(()=>window.netlifyIdentity.open('login'), 200); }
    }

    document.addEventListener('DOMContentLoaded', () => {
      setupIdentity();
      checkIdentityHealth();
    });
  </script>
</head>
<body>
  <div class="card">
    <h1>Welcome ✨</h1>
    <p>Private access only. Please log in.</p>
    <div class="row">
      <button onclick="openLogin()">Log in / Sign up</button>
    </div>
    <div id="debug"></div>
  </div>
</body>
</html>
